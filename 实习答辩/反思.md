# 反思

***
## 梁老师，那个，我不是很清楚这次咱们的BI系统的应用场景，但还是有点困惑，想跟你交流一下：
首先，也是最主要的一点，这个系统与咱游戏的关联性？是不是必须我们自己人做？

虽然从个人而言，H5和Web是我的强项，我也很高兴自己擅长的东西能派上用场，不如说我是大力支持咱们发展H5，拥抱ES6，和React或Vue这些技术的。但就我所知，我们工作室应该没有专门的前端人员（不是客户端），我们的主要业务不是游戏吗？

而从这次桃花岛系统看来，让Java程序去学习H5，其实是件挺有成本的事情，特别是一些比较新的，与以前东西完全不同的概念，像VirtualDom、前端路由这些，不管是React还是Vue，这些概念都逃不掉的，可以说是新一代前端技术的基础。

像这次花费这么多时间踩的那些坑，与其说是React和前端路由的坑（至少在我看来还不算难理解的东西），不如说是旧Js天生缺陷误用，和新Js（ES6、TypeScript）基础不足导致的坑。当然如会上所说，边做边学的心态与先学再做，不一样的心态可能也是一个原因，但我还是觉得，让Java程序学习前端技术不是那么容易的事情，希望您再慎重考虑。

我说自己花了3个月学习React真心不是开玩笑，React定位是扁平快的出项目，它本身的学习成本也不算太高，但麻烦在于，无论React还是Vue、Angular，这些技术不是独立的一个技术，背后有各自很大的生态圈的。Vue和Angular我不清楚，但像React，目前我们桃花岛系统用的其实还算很浅层的，往后涉及复杂业务时，还有数据绑定、复杂状态管理这些问题呢，一旦入坑React，后面大概就是数据驱动、函数式编程这些更晦涩的概念和Redux、Dva这些更复杂的框架了。

还有我们昨天都把目光放在顶层框架选择上面了，但我仔细想了想不太对，前端如今这样的局面大概是基于：`js => jQuery|Zepto => amd|umd|esmodule => NodeJs|WebPack => Ts/Es6/Jsx => React/Vue/Angular` ，一环接一环，这么一条线发展起来的，最佳学习路线也是重走一遍这个过程。即使其中一些已知失败的尝试也没必要再深入，但直接学习最顶层的东西的话，怎么说呢，大概就跟跳过sql和jdbc学hibernate一样吧。

扯远了，就单说React吧，要想将其成熟的运用在生产环境，还需要各个环节许多方面的技术转型配合！
我简单的举几个例子，一些具体技术细节你可以忽略，但我觉得我写出来可能更有说服力：

    0. 首先后端restful服务是逃不了的，这个大家也知道，好在也不复杂。

    1. 简单的，像昨天我们部署时遇到的，服务器根路径的坑：
    对于Java技术栈来说，`proto://ip:port/appRoot/url` 的url格式似乎已成唯一解（tomcat里好像也只能这么做？）
    但React，或者说现代前端开发不是的，前端惯用路径，准确的说是路由是这样的：`proto://servername/<version/>url`
    前端重点的项目一般后台基于nginx之类部署，而不是tomcat，类似 `app.domain` 的 servername 代替了port和appRoot。
    看似只是个url格式变化，但真的会造成很多问题，今天我们就因为这个导致项目部署在tomcat时各种路径404。

    2. 麻烦的，单页App，Js核心 vs Html文档：
    对于JSP来说，一个Web由一堆JSP（或Html文档）和相关的Js/Css组成，通过页面之间超链接跳转来组织逻辑是很正常的，
    但首先从效率讲，这十分低效，因为用户每次跳转都会重加载全局，要发一堆请求，在这期间还完全阻塞无法执行一些逻辑。
    其次对用户来说，这不太友好，跳转过程页面会卡住，会白屏，多个页面具有几乎相同的风格样式时更显得很傻很多余。
    当然，jQuery和ajax曾经一度是这个问题的最佳解决方案，直到前端复杂到像原生App一样有各种状态关联逻辑跳转。
    从开发角度，由于实质是一堆文档和零碎的脚本，难以抽象架构，导致难以维护扩展和复用，更别说考虑浏览器兼容了。
    前端现在推崇单页应用，一个Web是一个App，像桌面应用和原生App一样，尤其React，完全以Js为核心，而不再是HTML。
    这种全新的开发思想带来的好处，我个人概括说来就是，通过压缩混编减少页面初始请求，通过局部刷新实现高效交互，
    通过VirtualDom+statement解决jQuery+ajax的局限，通过组件模块实现抽象和复用，通过预编译自动补丁适配兼容。
    优点太多了，但像这次的桃花岛系统，在此之前我无法想象这东西对习惯了Jsp的大家来说这么难理解。

    3.致命的，前端路由，直接影响代码结构：
    说实话因为这个东西我最近一直被学姐吐槽，早知道不用它了，大不了多拷贝几份Html，或服务端做模板拼接。
    归根结底，这次前端路由主要导致的问题就是，参数传递机制与以往不同。虽然一个基于状态机的页面池就能解决这个问题。
    然而不巧的是，我小看了这东西，随便给学长交待了一下就去听那个对表会了，回来时发现大家已经在上面浪费了一下午。
    总之，前端路由这东西，对于前端，对于React，对于单页App来说太好用了，但确实比较侵入项目架构，影响代码组织方式。
    如果说React本身的话，还能比较简单的嵌入老的开发框架里去，但前端路由看来不行，这是这次桃花岛系统的教训。

    #. 其它诸如工具链、技术栈的适应也是个问题。
    无论React还是Vue，都离不开ES6、NodeJS这些Js扩展，以及npm、webpack这些工具，这也是这次桃花岛系统我体会较深的一点。
    我自己写的，在VSCode里，好看又好调试的代码，到了学长学姐那里，就变得着色混乱、各种报错、无法断点了，
    而且就算是学长们自己写的Js，在IDEA里的语法提示也是错漏百出，甚至连最基本的变量名拼错的坑都出现了好几回。
    之前还见到有同学在rtx里讨论lua的语法提示和断点调试工具什么的，开发C++的VS不能胜任。Js与IDEA看来也是这样。
    包括但不止以上。要想让新前端技术发挥威力，还需要很多比如部署预编译、cdn节点静态缓存，ESLint代码审查等工具支持。

说了这么多似乎有点扯远了，我只是觉得，咱们真的想好了，要投入精力到H5和Web上去？咱是否真的对成本和风险做好了心理准备和把握呢？当然，宏观战略什么的我不太懂，也不是很了解这次BI系统的需求，和其与咱主业务的关联与重要性，以上只是我个人的一些困惑和建议。

可能有些太远的东西我现在的眼界还看不透，只要你决定没问题我就会拿出满满的激情投入的（而且私心真的很希望咱们真的扩展H5这块，毕竟自己的强项。当初选择进喜欢的游戏行业还是擅长的Web领域可是纠结了很久的，如果这样的话那真是完美了）。

如果看完这些，你觉得有一些参考价值的话，希望能再重新考虑一下，至少，我们可以找些稍微接触过前端开发的，时间精力较多的同学先试试学习与适应的难度，这次参与桃花岛系统的学长学姐就很值得问问。如果是我个人去拿H5写个什么小东西我没意见，但如果要让大家一起接触的话还是调查一下更好吧？咱一堆做Java出生的临时学上一个月怎么也比不过专业的前端部门吧？

哦对了，这篇稿子为什么叫反思呢，因为我跟同学解释自己为何在游戏公司、Java岗位上写前端、写JS的时候，自己却有点懵比。。。所以就反思了一下，然后越想越多就这样了。倒不是有什么迷惘或不满，不如说最近H5抽奖系统的事情让我都有点自信过剩了，挺感谢老师给的这次机会的。
